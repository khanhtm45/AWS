<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test T·∫°o S·∫£n Ph·∫©m - Product Creation Test</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .config-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #4CAF50;
            margin-top: 0;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        .tags-input {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .mt-10 { margin-top: 10px; }
        }
        .tag {
            background: #e3f2fd;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        .tag-remove {
            cursor: pointer;
            color: #f44336;
            font-weight: bold;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        button.secondary {
            background-color: #2196F3;
        }
        button.secondary:hover {
            background-color: #1976D2;
        }
        button.danger {
            background-color: #f44336;
        }
        button.danger:hover {
            background-color: #d32f2f;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .info {
            color: #2196F3;
        }
        .warning {
            color: #ff9800;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 0;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #e0e0e0;
            margin: 0 5px;
            border-radius: 4px;
            font-weight: 600;
        }
        .step.active {
            background: #4CAF50;
            color: white;
        }
        .step.completed {
            background: #81C784;
            color: white;
        }
        .variant-attributes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .variant-attribute {
            display: flex;
            gap: 10px;
        }
        .variant-attribute input {
            flex: 1;
        }
        .load-data-btn {
            background-color: #9E9E9E;
            font-size: 12px;
            padding: 6px 12px;
        }
        .load-data-btn:hover {
            background-color: #757575;
        }
        .data-list {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            max-height: 150px;
            overflow-y: auto;
        }
        .data-item {
            padding: 5px;
            margin: 3px 0;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .data-item:hover {
            background: #e3f2fd;
        }
        .quick-fill {
            font-size: 11px;
            color: #666;
            cursor: pointer;
            text-decoration: underline;
            margin-left: 10px;
        }
        .quick-fill:hover {
            color: #2196F3;
        }
        /* Utility classes to replace inline styles */
        .full-width { width: 100%; }
        .hidden { display: none; }
        .inline-label { display: inline; font-weight: normal; }
        .required { color: red; }
        .small-btn { padding: 5px 10px; font-size: 12px; }
        .img-preview { max-width: 300px; margin: 10px 0; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>üß™ Test T·∫°o S·∫£n Ph·∫©m - Product Creation Test</h1>
    
    <div class="config-section">
        <h2>‚öôÔ∏è C·∫•u H√¨nh</h2>
        <div class="form-group">
            <label for="apiBase">API Base URL:</label>
            <input type="text" id="apiBase" value="http://localhost:8080" class="full-width">
        </div>
    </div>

    <div class="step-indicator">
        <div class="step active" id="step1-indicator">1. Category</div>
        <div class="step" id="step2-indicator">2. Product Type</div>
        <div class="step" id="step3-indicator">3. Product</div>
        <div class="step" id="step4-indicator">4. Variant</div>
    </div>

    <!-- Section 1: Create Category -->
    <div class="section" id="section-category">
        <h2>1. üìÅ T·∫°o Category</h2>
        <div class="form-group">
            <label for="categoryId">Category ID <span class="required">*</span>:</label>
            <input type="text" id="categoryId" placeholder="CAT001">
        </div>
        <div class="form-group">
            <label for="categoryName">Category Name <span class="required">*</span>:</label>
            <input type="text" id="categoryName" placeholder="√Åo Nam">
        </div>
        <div class="form-group">
            <label for="parentCategoryId">Parent Category ID (optional):</label>
            <input type="text" id="parentCategoryId" placeholder="CAT001">
        </div>
        <div class="form-group">
            <label for="categoryLevel">Category Level:</label>
            <input type="number" id="categoryLevel" value="1" min="1" max="5">
        </div>
        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" id="categoryIsActive" checked>
                <label for="categoryIsActive" class="inline-label">Is Active</label>
            </div>
        </div>
        <button onclick="createCategory()">T·∫°o Category</button>
        <button class="secondary" onclick="loadCategories()">Load Danh S√°ch Categories</button>
        <div id="categoriesList" class="data-list hidden"></div>
    </div>

    <!-- Section 2: Create Product Type -->
    <div class="section" id="section-type">
        <h2>2. üè∑Ô∏è T·∫°o Product Type</h2>
        <div class="form-group">
            <label for="typeId">Type ID <span class="required">*</span>:</label>
            <input type="text" id="typeId" placeholder="TYPE001">
        </div>
        <div class="form-group">
            <label for="typeName">Type Name <span class="required">*</span>:</label>
            <input type="text" id="typeName" placeholder="Physical">
        </div>
        <div class="form-group">
            <label>Type Description (optional):</label>
            <textarea id="typeDescription" placeholder="S·∫£n ph·∫©m v·∫≠t l√Ω, c√≥ th·ªÉ c·∫ßm n·∫Øm, v·∫≠n chuy·ªÉn ƒë∆∞·ª£c"></textarea>
        </div>
        <button onclick="createProductType()">T·∫°o Product Type</button>
        <button class="secondary" onclick="loadProductTypes()">Load Danh S√°ch Types</button>
        <div id="typesList" class="data-list hidden"></div>
    </div>

    <!-- Section 3: Create Product -->
    <div class="section" id="section-product">
        <h2>3. üì¶ T·∫°o Product</h2>
        <div class="form-group">
            <label for="productId">Product ID <span class="required">*</span>:</label>
            <input type="text" id="productId" placeholder="PROD001">
            <span class="quick-fill" onclick="fillProductId()">T·ª± ƒë·ªông t·∫°o ID</span>
        </div>
        <div class="form-group">
            <label for="productName">Product Name <span class="required">*</span>:</label>
            <input type="text" id="productName" placeholder="√Åo Thun Nam C·ªï Tr√≤n Basic">
        </div>
        <div class="form-group">
            <label>Description (optional):</label>
            <textarea id="productDescription" placeholder="√Åo thun nam ch·∫•t li·ªáu cotton 100%, m·ªÅm m·∫°i, tho√°ng m√°t"></textarea>
        </div>
        <div class="form-group">
            <label for="productPrice">Price <span class="required">*</span>:</label>
            <input type="number" id="productPrice" placeholder="199000" step="0.01" min="0">
        </div>
        <div class="form-group">
            <label>Category ID:</label>
            <input type="text" id="productCategoryId" placeholder="CAT001">
            <button class="load-data-btn" onclick="loadCategoriesForProduct()">Load Categories</button>
            <div id="categoriesForProduct" class="data-list hidden"></div>
        </div>
        <div class="form-group">
            <label>Type ID:</label>
            <input type="text" id="productTypeId" placeholder="TYPE001">
            <button class="load-data-btn" onclick="loadTypesForProduct()">Load Types</button>
            <div id="typesForProduct" class="data-list hidden"></div>
        </div>
        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" id="productIsPreorder">
                <label for="productIsPreorder" class="inline-label">Is Preorder</label>
            </div>
        </div>
        <div class="form-group hidden" id="preorderDaysGroup">
            <label>Preorder Days:</label>
            <input type="number" id="productPreorderDays" placeholder="7" min="1">
        </div>
        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" id="productIsActive" checked>
                <label for="productIsActive" class="inline-label">Is Active</label>
            </div>
        </div>
        <div class="form-group">
            <label>Tags (nh·∫•n Enter ƒë·ªÉ th√™m):</label>
            <input type="text" id="tagInput" placeholder="Nh·∫≠p tag v√† nh·∫•n Enter">
            <div id="tagsContainer" class="tags-input"></div>
        </div>
        <button onclick="createProduct()">T·∫°o Product</button>
        <button class="secondary" onclick="loadProducts()">Load Danh S√°ch Products</button>
        <div id="productsList" class="data-list hidden"></div>
    </div>

    <!-- Section 4: Create Product Variant -->
    <div class="section" id="section-variant">
        <h2>4. üé® T·∫°o Product Variant</h2>
        <div class="form-group">
            <label for="variantProductId">Product ID <span class="required">*</span>:</label>
            <input type="text" id="variantProductId" placeholder="PROD001">
            <button class="load-data-btn" onclick="loadProductsForVariant()">Load Products</button>
            <div id="productsForVariant" class="data-list hidden"></div>
        </div>
        <div class="form-group">
            <label for="variantId">Variant ID <span class="required">*</span>:</label>
            <input type="text" id="variantId" placeholder="VAR001">
            <span class="quick-fill" onclick="fillVariantId()">T·ª± ƒë·ªông t·∫°o ID</span>
        </div>
        <div class="form-group">
            <label>Variant Attributes (v√≠ d·ª•: color, size):</label>
            <div id="variantAttributesContainer">
                <div class="variant-attribute">
                    <input type="text" placeholder="Key (v√≠ d·ª•: color)" class="attr-key">
                    <input type="text" placeholder="Value (v√≠ d·ª•: Tr·∫Øng)" class="attr-value">
                </div>
            </div>
            <button class="load-data-btn mt-10" onclick="addVariantAttribute()">+ Th√™m Attribute</button>
        </div>
        <div class="form-group">
            <label>Variant Price (optional, ƒë·ªÉ tr·ªëng s·∫Ω d√πng gi√° product):</label>
            <input type="number" id="variantPrice" placeholder="199000" step="0.01" min="0">
        </div>
        <div class="form-group">
            <label>SKU (optional):</label>
            <input type="text" id="variantSku" placeholder="PROD001-WHITE-M">
        </div>
        <div class="form-group">
            <label>Barcode (optional):</label>
            <input type="text" id="variantBarcode" placeholder="8931234567890">
        </div>
        <button onclick="createVariant()">T·∫°o Variant</button>
        <button class="secondary" onclick="loadVariants()">Load Danh S√°ch Variants</button>
        <div id="variantsList" class="data-list hidden"></div>
    </div>

    <div id="result"></div>

    <script>
        let tags = [];
        let apiBase = 'http://localhost:8080';

        // Update API base when input changes
        document.getElementById('apiBase').addEventListener('change', function() {
            apiBase = this.value;
            log(`üîß API Base URL ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t: ${apiBase}`, 'info');
        });

        // Preorder days toggle
        document.getElementById('productIsPreorder').addEventListener('change', function() {
            document.getElementById('preorderDaysGroup').style.display = this.checked ? 'block' : 'none';
        });

        // Tag input handler
        document.getElementById('tagInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tag = this.value.trim();
                if (tag && !tags.includes(tag)) {
                    tags.push(tag);
                    updateTagsDisplay();
                    this.value = '';
                }
            }
        });

        function updateTagsDisplay() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = tags.map(tag => 
                `<span class="tag">${tag} <span class="tag-remove" onclick="removeTag('${tag}')">√ó</span></span>`
            ).join('');
        }

        function removeTag(tag) {
            tags = tags.filter(t => t !== tag);
            updateTagsDisplay();
        }

        function addVariantAttribute() {
            const container = document.getElementById('variantAttributesContainer');
            const div = document.createElement('div');
            div.className = 'variant-attribute';
            div.innerHTML = `
                <input type="text" placeholder="Key (v√≠ d·ª•: color)" class="attr-key">
                <input type="text" placeholder="Value (v√≠ d·ª•: Tr·∫Øng)" class="attr-value">
                <button class="danger" onclick="this.parentElement.remove()" style="padding: 5px 10px; font-size: 12px;">X√≥a</button>
            `;
            container.appendChild(div);
        }

        function log(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            resultDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }

        function clearResult() {
            document.getElementById('result').innerHTML = '';
        }

        function fillProductId() {
            document.getElementById('productId').value = 'PROD' + String(Date.now()).slice(-6);
            log('‚úÖ ƒê√£ t·ª± ƒë·ªông t·∫°o Product ID', 'success');
        }

        function fillVariantId() {
            document.getElementById('variantId').value = 'VAR' + String(Date.now()).slice(-6);
            log('‚úÖ ƒê√£ t·ª± ƒë·ªông t·∫°o Variant ID', 'success');
        }

        // ========== CATEGORY FUNCTIONS ==========
        async function createCategory() {
            const categoryId = document.getElementById('categoryId').value.trim();
            const categoryName = document.getElementById('categoryName').value.trim();
            const parentCategoryId = document.getElementById('parentCategoryId').value.trim();
            const categoryLevel = parseInt(document.getElementById('categoryLevel').value) || 1;
            const isActive = document.getElementById('categoryIsActive').checked;

            if (!categoryId || !categoryName) {
                log('‚ùå Vui l√≤ng nh·∫≠p Category ID v√† Category Name', 'error');
                return;
            }

            log(`üì§ ƒêang t·∫°o Category: ${categoryId}...`, 'info');

            try {
                const response = await fetch(`${apiBase}/api/categories`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        categoryId: categoryId,
                        categoryName: categoryName,
                        parentCategoryId: parentCategoryId || null,
                        categoryLevel: categoryLevel,
                        isActive: isActive
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ T·∫°o Category th√†nh c√¥ng!`, 'success');
                    log(`   Category ID: ${data.categoryId}`, 'info');
                    log(`   Category Name: ${data.categoryName}`, 'info');
                    log(`   Category Level: ${data.categoryLevel}`, 'info');
                    updateStepIndicator(1, true);
                } else {
                    const errorText = await response.text();
                    throw new Error(`Failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        async function loadCategories() {
            const listDiv = document.getElementById('categoriesList');
            log('üì• ƒêang load danh s√°ch categories...', 'info');

            try {
                const response = await fetch(`${apiBase}/api/categories`);
                if (response.ok) {
                    const categories = await response.json();
                    listDiv.innerHTML = categories.map(cat => 
                        `<div class="data-item" onclick="selectCategory('${cat.categoryId}', '${cat.categoryName}')">
                            <strong>${cat.categoryId}</strong> - ${cat.categoryName} (Level: ${cat.categoryLevel})
                        </div>`
                    ).join('');
                    listDiv.style.display = 'block';
                    log(`‚úÖ ƒê√£ load ${categories.length} categories`, 'success');
                } else {
                    throw new Error(`Failed: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        function selectCategory(categoryId, categoryName) {
            document.getElementById('categoryId').value = categoryId;
            document.getElementById('categoryName').value = categoryName;
            document.getElementById('categoriesList').style.display = 'none';
        }

        function loadCategoriesForProduct() {
            const listDiv = document.getElementById('categoriesForProduct');
            loadCategories();
            listDiv.innerHTML = document.getElementById('categoriesList').innerHTML;
            listDiv.style.display = 'block';
            document.getElementById('categoriesList').style.display = 'none';
        }

        // ========== PRODUCT TYPE FUNCTIONS ==========
        async function createProductType() {
            const typeId = document.getElementById('typeId').value.trim();
            const typeName = document.getElementById('typeName').value.trim();
            const typeDescription = document.getElementById('typeDescription').value.trim();

            if (!typeId || !typeName) {
                log('‚ùå Vui l√≤ng nh·∫≠p Type ID v√† Type Name', 'error');
                return;
            }

            log(`üì§ ƒêang t·∫°o Product Type: ${typeId}...`, 'info');

            try {
                const response = await fetch(`${apiBase}/api/product-types`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        typeId: typeId,
                        typeName: typeName,
                        typeDescription: typeDescription || null
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ T·∫°o Product Type th√†nh c√¥ng!`, 'success');
                    log(`   Type ID: ${data.typeId}`, 'info');
                    log(`   Type Name: ${data.typeName}`, 'info');
                    updateStepIndicator(2, true);
                } else {
                    const errorText = await response.text();
                    throw new Error(`Failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        async function loadProductTypes() {
            const listDiv = document.getElementById('typesList');
            log('üì• ƒêang load danh s√°ch product types...', 'info');

            try {
                const response = await fetch(`${apiBase}/api/product-types`);
                if (response.ok) {
                    const types = await response.json();
                    listDiv.innerHTML = types.map(type => 
                        `<div class="data-item" onclick="selectType('${type.typeId}', '${type.typeName}')">
                            <strong>${type.typeId}</strong> - ${type.typeName}
                        </div>`
                    ).join('');
                    listDiv.style.display = 'block';
                    log(`‚úÖ ƒê√£ load ${types.length} product types`, 'success');
                } else {
                    throw new Error(`Failed: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        function selectType(typeId, typeName) {
            document.getElementById('typeId').value = typeId;
            document.getElementById('typeName').value = typeName;
            document.getElementById('typesList').style.display = 'none';
        }

        function loadTypesForProduct() {
            const listDiv = document.getElementById('typesForProduct');
            loadProductTypes();
            setTimeout(() => {
                listDiv.innerHTML = document.getElementById('typesList').innerHTML;
                listDiv.style.display = 'block';
                document.getElementById('typesList').style.display = 'none';
            }, 500);
        }

        // ========== PRODUCT FUNCTIONS ==========
        async function createProduct() {
            const productId = document.getElementById('productId').value.trim();
            const name = document.getElementById('productName').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const categoryId = document.getElementById('productCategoryId').value.trim();
            const typeId = document.getElementById('productTypeId').value.trim();
            const isPreorder = document.getElementById('productIsPreorder').checked;
            const preorderDays = isPreorder ? parseInt(document.getElementById('productPreorderDays').value) : null;
            const isActive = document.getElementById('productIsActive').checked;

            if (!productId || !name || !price || isNaN(price)) {
                log('‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Product ID, Name v√† Price', 'error');
                return;
            }

            log(`üì§ ƒêang t·∫°o Product: ${productId}...`, 'info');

            const productData = {
                productId: productId,
                name: name,
                price: price,
                isActive: isActive
            };

            if (description) productData.description = description;
            if (categoryId) productData.categoryId = categoryId;
            if (typeId) productData.typeId = typeId;
            if (isPreorder) {
                productData.isPreorder = true;
                if (preorderDays) productData.preorderDays = preorderDays;
            }
            if (tags.length > 0) productData.tags = tags;

            try {
                const response = await fetch(`${apiBase}/api/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productData)
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ T·∫°o Product th√†nh c√¥ng!`, 'success');
                    log(`   Product ID: ${data.productId}`, 'info');
                    log(`   Name: ${data.name}`, 'info');
                    log(`   Price: ${data.price}`, 'info');
                    if (data.categoryId) log(`   Category ID: ${data.categoryId}`, 'info');
                    if (data.typeId) log(`   Type ID: ${data.typeId}`, 'info');
                    updateStepIndicator(3, true);
                    // Auto-fill variant product ID
                    document.getElementById('variantProductId').value = productId;
                } else {
                    const errorText = await response.text();
                    throw new Error(`Failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        async function loadProducts() {
            const listDiv = document.getElementById('productsList');
            log('üì• ƒêang load danh s√°ch products...', 'info');

            try {
                const response = await fetch(`${apiBase}/api/products`);
                if (response.ok) {
                    const products = await response.json();
                    listDiv.innerHTML = products.map(prod => 
                        `<div class="data-item" onclick="selectProduct('${prod.productId}', '${prod.name}')">
                            <strong>${prod.productId}</strong> - ${prod.name} (${prod.price} VNƒê)
                        </div>`
                    ).join('');
                    listDiv.style.display = 'block';
                    log(`‚úÖ ƒê√£ load ${products.length} products`, 'success');
                } else {
                    throw new Error(`Failed: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        function selectProduct(productId, productName) {
            document.getElementById('productId').value = productId;
            document.getElementById('productName').value = productName;
            document.getElementById('productsList').style.display = 'none';
        }

        function loadProductsForVariant() {
            const listDiv = document.getElementById('productsForVariant');
            loadProducts();
            setTimeout(() => {
                listDiv.innerHTML = document.getElementById('productsList').innerHTML;
                listDiv.style.display = 'block';
                document.getElementById('productsList').style.display = 'none';
            }, 500);
        }

        // ========== VARIANT FUNCTIONS ==========
        async function createVariant() {
            const productId = document.getElementById('variantProductId').value.trim();
            const variantId = document.getElementById('variantId').value.trim();
            const variantPrice = document.getElementById('variantPrice').value.trim();
            const sku = document.getElementById('variantSku').value.trim();
            const barcode = document.getElementById('variantBarcode').value.trim();

            if (!productId || !variantId) {
                log('‚ùå Vui l√≤ng nh·∫≠p Product ID v√† Variant ID', 'error');
                return;
            }

            // Collect variant attributes
            const variantAttributes = {};
            const attrInputs = document.querySelectorAll('#variantAttributesContainer .variant-attribute');
            attrInputs.forEach(attrDiv => {
                const key = attrDiv.querySelector('.attr-key').value.trim();
                const value = attrDiv.querySelector('.attr-value').value.trim();
                if (key && value) {
                    variantAttributes[key] = value;
                }
            });

            log(`üì§ ƒêang t·∫°o Variant: ${variantId} cho Product: ${productId}...`, 'info');

            const variantData = {
                variantId: variantId,
                variantAttributes: variantAttributes
            };

            if (variantPrice) variantData.variantPrice = parseFloat(variantPrice);
            if (sku) variantData.sku = sku;
            if (barcode) variantData.barcode = barcode;

            try {
                const response = await fetch(`${apiBase}/api/products/${encodeURIComponent(productId)}/variants`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(variantData)
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ T·∫°o Variant th√†nh c√¥ng!`, 'success');
                    log(`   Product ID: ${data.productId}`, 'info');
                    log(`   Variant ID: ${data.variantId}`, 'info');
                    log(`   Variant Attributes: ${JSON.stringify(data.variantAttributes)}`, 'info');
                    if (data.sku) log(`   SKU: ${data.sku}`, 'info');
                    updateStepIndicator(4, true);
                } else {
                    const errorText = await response.text();
                    throw new Error(`Failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        async function loadVariants() {
            const productId = document.getElementById('variantProductId').value.trim();
            if (!productId) {
                log('‚ùå Vui l√≤ng nh·∫≠p Product ID tr∆∞·ªõc', 'error');
                return;
            }

            const listDiv = document.getElementById('variantsList');
            log(`üì• ƒêang load danh s√°ch variants cho Product: ${productId}...`, 'info');

            try {
                const response = await fetch(`${apiBase}/api/products/${encodeURIComponent(productId)}/variants`);
                if (response.ok) {
                    const variants = await response.json();
                    listDiv.innerHTML = variants.map(variant => 
                        `<div class="data-item" onclick="selectVariant('${variant.variantId}')">
                            <strong>${variant.variantId}</strong> - ${JSON.stringify(variant.variantAttributes)} ${variant.sku ? `(SKU: ${variant.sku})` : ''}
                        </div>`
                    ).join('');
                    listDiv.style.display = 'block';
                    log(`‚úÖ ƒê√£ load ${variants.length} variants`, 'success');
                } else {
                    throw new Error(`Failed: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        function selectVariant(variantId) {
            document.getElementById('variantId').value = variantId;
            document.getElementById('variantsList').style.display = 'none';
        }

        function updateStepIndicator(step, completed) {
            for (let i = 1; i <= 4; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                if (i < step) {
                    indicator.className = 'step completed';
                } else if (i === step && completed) {
                    indicator.className = 'step completed';
                } else if (i === step) {
                    indicator.className = 'step active';
                } else {
                    indicator.className = 'step';
                }
            }
        }

        // Initialize
        apiBase = document.getElementById('apiBase').value;
    </script>
</body>
</html>


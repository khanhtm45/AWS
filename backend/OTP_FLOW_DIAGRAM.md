# ğŸ”„ OTP Login Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OTP LOGIN WITH REDIS FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚         â”‚ Backend  â”‚         â”‚ Redis â”‚         â”‚ Email â”‚
â”‚ Browser  â”‚         â”‚  (Java)  â”‚         â”‚       â”‚         â”‚ (SMTP)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚ [1] POST /send-otp â”‚                   â”‚                 â”‚
     â”‚   { email }        â”‚                   â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [2] Check email   â”‚                 â”‚
     â”‚                    â”‚     in DynamoDB   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [3] Generate OTP  â”‚                 â”‚
     â”‚                    â”‚     (6 digits)    â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [4] SET OTP:email â”‚                 â”‚
     â”‚                    â”‚     value=123456  â”‚                 â”‚
     â”‚                    â”‚     TTL=300s      â”‚                 â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚        OK         â”‚                 â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [5] Send email    â”‚                 â”‚
     â”‚                    â”‚     with OTP      â”‚                 â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚     200 OK         â”‚                   â”‚        [6] ğŸ“§   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚         Sent    â”‚
     â”‚  "OTP Ä‘Ã£ gá»­i"      â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”œâ”€â”€â”€ â° User waits for email & enters OTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚[7] POST /verify-   â”‚                   â”‚                 â”‚
     â”‚    otp-login       â”‚                   â”‚                 â”‚
     â”‚   { email, otp }   â”‚                   â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [8] GET OTP:email â”‚                 â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚   value=123456    â”‚                 â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [9] Compare OTP   â”‚                 â”‚
     â”‚                    â”‚     âœ… Match!     â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚ [10] DEL OTP:emailâ”‚                 â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚        OK         â”‚                 â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚                    â”‚[11] Generate JWT  â”‚                 â”‚
     â”‚                    â”‚     + Refresh     â”‚                 â”‚
     â”‚                    â”‚     Token         â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚  200 OK            â”‚                   â”‚                 â”‚
     â”‚  { accessToken,    â”‚                   â”‚                 â”‚
     â”‚    refreshToken }  â”‚                   â”‚                 â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚[12] Store tokens   â”‚                   â”‚                 â”‚
     â”‚     in localStorageâ”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â”‚[13] Navigate to    â”‚                   â”‚                 â”‚
     â”‚     /home          â”‚                   â”‚                 â”‚
     â”‚                    â”‚                   â”‚                 â”‚
     â–¼                    â–¼                   â–¼                 â–¼

     âœ… Logged In!


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              KEY COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ REDIS STRUCTURE:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Key:   OTP:user@example.com                    â”‚
   â”‚ Value: 123456                                   â”‚
   â”‚ TTL:   300 seconds (5 minutes)                  â”‚
   â”‚ Type:  String                                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¯ OTP GENERATION:
   â€¢ 6-digit random number
   â€¢ Range: 100000 - 999999
   â€¢ Algorithm: Math.random() * 900000 + 100000

â±ï¸  EXPIRATION:
   â€¢ OTP expires after 5 minutes (300 seconds)
   â€¢ Redis automatically deletes expired keys
   â€¢ No manual cleanup needed

ğŸ”’ SECURITY:
   â€¢ OTP is deleted after successful verification
   â€¢ Cannot reuse same OTP
   â€¢ Email-based authentication
   â€¢ JWT + Refresh token for session management

ğŸ“§ EMAIL TEMPLATE:
   â€¢ HTML formatted
   â€¢ Responsive design
   â€¢ Clear OTP display
   â€¢ Expiration warning
   â€¢ Professional branding


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            ERROR SCENARIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ Case 1: Email not found
   â†’ Response: "Email khÃ´ng tá»“n táº¡i trong há»‡ thá»‘ng"

âŒ Case 2: OTP expired (> 5 minutes)
   â†’ Redis returns null (key deleted)
   â†’ Response: "OTP Ä‘Ã£ háº¿t háº¡n hoáº·c khÃ´ng tá»“n táº¡i"

âŒ Case 3: Wrong OTP
   â†’ OTP doesn't match
   â†’ Response: "OTP khÃ´ng chÃ­nh xÃ¡c"

âŒ Case 4: Email sending fails
   â†’ SMTP error
   â†’ Response: "KhÃ´ng thá»ƒ gá»­i email. Vui lÃ²ng thá»­ láº¡i sau"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            TECH STACK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Backend:
  â€¢ Spring Boot 3.2.0
  â€¢ Java 17
  â€¢ Redis (Lettuce client)
  â€¢ JWT (io.jsonwebtoken)
  â€¢ JavaMail (Gmail SMTP)

Database:
  â€¢ DynamoDB (User data)
  â€¢ Redis (OTP cache)

Frontend:
  â€¢ HTML5 + CSS3 + Vanilla JavaScript
  â€¢ Fetch API for HTTP requests


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          FILE STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

backend/
â”œâ”€â”€ src/main/java/com/leafshop/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ AuthController.java          # API endpoints
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ OtpService.java              # OTP + Redis logic
â”‚   â”‚   â”œâ”€â”€ AuthService.java             # Authentication logic
â”‚   â”‚   â””â”€â”€ EmailService.java            # Email sending
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ RedisConfig.java             # Redis configuration
â”‚   â””â”€â”€ dto/auth/
â”‚       â”œâ”€â”€ LoginOtpRequest.java         # { email }
â”‚       â””â”€â”€ VerifyLoginOtpRequest.java   # { email, otp }
â”œâ”€â”€ test-otp-redis-login.html            # Test UI
â”œâ”€â”€ OTP_LOGIN_REDIS.md                   # Documentation
â””â”€â”€ start-otp-test.ps1                   # Quick start script
```
